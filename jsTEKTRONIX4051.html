<html>

<head>

<TITLE>jsTEKTRONIX4051 - A Tektronix 4051 emulator written in Javascript. Copyright (c) 2015 David E. Roberts.</TITLE>

<style>
body {font-size:small; line-height:140%; padding:2px;}
table {font-size:small; line-height:140%; padding:2px;}
a:hover {background:yellow}
h1 {color:red}
big {color:red}
</style>

<script src="MC6800.js"        language="JavaScript"></script>
<script src="Tek4051Rom.js"    language="JavaScript"></script>
<script src="TekDisplay.js"    language="JavaScript"></script>
<script src="TekKeyboard.js"    language="JavaScript"></script>
<script src="TEKTRONIX4051.js" language="JavaScript"></script>

</head>

<body onload="tek_init();">

<div style="width:2000px; margin: 2em auto 0 auto;">

<table><tr>

<td valign=top style="width:1000px;">
<div id="middlecolumn" style="width:1000px;">

<table>
<tr>
<td><canvas id="canvas" name="canvas" width="1024" height="780" style="border: medium solid ;"> </canvas></td>
</tr>
</table>

<br>

<input id="start" value="start" onclick="javascript:tek_start();" type="button">
<input id="stop"  value="pause" disabled="true" onclick="javascript:tek_stop();" type="button">
<input id="reset" value="reset" onclick="javascript:tek_reset();" type="button">

Interrupts:
<input id="interrupts" value="0" size="5" type="text">

GPIB PROGRAM LOAD:
<input type='file' id='loadfile' onchange='javascript:tek_load()'>

<br>

</div>

<div>
<pre style="border: medium solid ;"><p id="logbuf">Console:
</p>
</pre>
</div>

<div>
<script language="JavaScript">

var tek;


function tek_init() {
    
    //rom_firmware();
    
    var mylogbuf    = document.getElementById('logbuf');

    var mycanvas    = document.getElementById('canvas');
    
    var mycanvasctx = mycanvas.getContext("2d");
    
    tek = new TEKTRONIX4051( window, mycanvasctx, mylogbuf );
    
} // End of function tek_init.

function tek_start() {

    tek.execute_start.apply( tek );

    document.getElementById('start').disabled   = true;
    document.getElementById('stop').disabled    = false;

} // End of function tek_start.

function tek_stop() {

    tek.execute_stop.apply( tek );

    document.getElementById('start').disabled = false;
    document.getElementById('stop').disabled  = true;

} // End of function tek_stop.

function tek_reset() {

    tek.execute_reset.call( tek );

    tek.interruptCounter = 0;

} // End of function tek_reset.

function tek_load() {

  // See what file has been selected by the user (if any).
  var file = document.getElementById('loadfile').files[0];
  
  // Ignore if no file has been selected by the user.
  if( !file )
    return;
    
  // Create a new instance of the FileReader to actually read the selected file.
  var fread = new FileReader();
  
  // This is the function invoked after a successful file load.
  fread.onload = function( levent ) {
  
    var data = new DataView( levent.target.result );
    
    var size = levent.target.result.byteLength;
    
    var i;
    
    var bytes = Array( size );
    
    for( i=0; i<size; i++ )
      bytes[i] = data.getUint8( i );
      
    tek.execute_load.call( tek, size, bytes ); 
    
  } // End of function fread.onload.
  
  // Initiate the file load.
  fread.readAsArrayBuffer( file );
  
} // End of function tek_load.

</script>
</div>



</div>
</td>

<td valign=top style="width:160px;">
<br><br>
</td>

</tr></table>
</div>
</body>

</html>
